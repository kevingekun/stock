webpackJsonp([4],{"5PlU":function(e,t,n){var r=n("RY/4"),a=n("dSzd")("iterator"),o=n("/bQp");e.exports=n("FeBl").isIterable=function(e){var t=Object(e);return void 0!==t[a]||"@@iterator"in t||o.hasOwnProperty(r(t))}},"8Z2I":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("d7EF"),a=n.n(r),o=n("BO1k"),c=n.n(o),i=n("Xxa5"),s=n.n(i),l=n("exGp"),u=n.n(l),d=n("woOf"),f=n.n(d),p=n("XLwt"),h=n("vLgD");function k(e){return Object(h.a)({url:"/historyKl/list",method:"get",params:e})}var v={keyword:null,pageNum:1,pageSize:5,publishStatus:null,verifyStatus:null,productSn:null,productCategoryId:null,brandId:null},m={name:"StockCharts",data:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-31536e6),{listQuery:f()({},v),stocks:[],charts:[],dateRange:[t,e],selectedStockCode:"",newStockCode:"",loading:!1,pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-6048e5),e.$emit("pick",[n,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-2592e6),e.$emit("pick",[n,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-7776e6),e.$emit("pick",[n,t])}},{text:"最近六个月",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-15552e6),e.$emit("pick",[n,t])}},{text:"最近一年",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-31536e6),e.$emit("pick",[n,t])}},{text:"最近两年",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-63072e6),e.$emit("pick",[n,t])}},{text:"最近三年",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-94608e6),e.$emit("pick",[n,t])}},{text:"最近五年",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-15768e7),e.$emit("pick",[n,t])}},{text:"全部",onClick:function(e){var t=new Date,n=new Date;n.setTime(new Date("2015-01-01").getTime()),e.$emit("pick",[n,t])}}]}}},computed:{filteredStocks:function(){var e=this;return this.selectedStockCode?this.stocks.filter(function(t){return t.code===e.selectedStockCode}):this.stocks}},mounted:function(){var e=this;return u()(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetchStocks();case 2:return t.next=4,e.createCharts();case 4:case"end":return t.stop()}},t,e)}))()},methods:{fetchStocks:function(){var e=this;return u()(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(n=e.listQuery,Object(h.a)({url:"/stocksBase/listAll",method:"get",params:n})).then(function(t){e.stocks=t.data});case 2:case"end":return t.stop()}var n},t,e)}))()},createCharts:function(){var e=this;return u()(s.a.mark(function t(){var n,r,a,o,i,l;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.charts.forEach(function(e){e&&e.dispose()}),e.charts=[],t.next=4,e.$nextTick();case 4:n=!0,r=!1,a=void 0,t.prev=7,o=c()(e.filteredStocks);case 9:if(n=(i=o.next()).done){t.next=16;break}return l=i.value,t.next=13,e.createChart(l);case 13:n=!0,t.next=9;break;case 16:t.next=22;break;case 18:t.prev=18,t.t0=t.catch(7),r=!0,a=t.t0;case 22:t.prev=22,t.prev=23,!n&&o.return&&o.return();case 25:if(t.prev=25,!r){t.next=28;break}throw a;case 28:return t.finish(25);case 29:return t.finish(22);case 30:e.handleResize=function(){e.charts.forEach(function(e){e&&e.resize()})},window.addEventListener("resize",e.handleResize),console.log("All charts loaded");case 33:case"end":return t.stop()}},t,e,[[7,18,22,30],[23,,25,29]])}))()},createChart:function(e){var t=this;return u()(s.a.mark(function n(){var r,o,c,i,l,u,d,f;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r="chart-"+e.code,o=document.getElementById(r)){n.next=5;break}return console.warn("Container "+r+" not found"),n.abrupt("return");case 5:return c=p.init(o),t.charts.push(c),i=t.dateRange||[null,null],l=a()(i,2),u=l[0],d=l[1],f={code:e.code,startDate:u?u.toISOString().split("T")[0]:null,endDate:d?d.toISOString().split("T")[0]:null},n.next=11,k(f).then(function(t){var n=t.data.historyKlList,r=n.map(function(e){return e.dataTime}),a=n.map(function(e){return[e.openPrice,e.closePrice,e.lowPrice,e.highPrice]}),o={title:{text:e.name+" ("+e.code+")",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:r,boundaryGap:!0,axisLine:{onZero:!1},splitLine:{show:!1},min:"dataMin",max:"dataMax"},yAxis:{scale:!0,splitArea:{show:!0}},dataZoom:[{type:"inside",start:0,end:100},{show:!0,type:"slider",top:"90%",start:0,end:100}],series:[{name:"Price",type:"candlestick",data:a,itemStyle:{color:"#00da3c",color0:"#ec0000",borderColor:"#008F28",borderColor0:"#8A0000"},large:!0}]};c.setOption(o)}).catch(function(t){console.error("Failed to fetch data for "+e.code+":",t)});case 11:case"end":return n.stop()}},n,t)}))()},handleSubscribe:function(){var e=this;return u()(s.a.mark(function t(){var n;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.newStockCode){t.next=3;break}return e.$message.error("请输入股票代码"),t.abrupt("return");case 3:return e.loading=!0,t.prev=4,t.next=7,r={code:e.newStockCode},Object(h.a)({url:"/historyKl/subscribe",method:"get",params:r});case 7:200===(n=t.sent).code?(e.$message.success("订阅成功"),setTimeout(u()(s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!1,t.next=3,e.fetchStocks();case 3:return t.next=5,e.createCharts();case 5:case"end":return t.stop()}},t,e)})),8e3)):(e.$message.error(n.message||"订阅失败"),e.loading=!1),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(4),console.error("Subscription error:",t.t0),e.loading=!1;case 15:case"end":return t.stop()}var r},t,e,[[4,11]])}))()},handleUnSubscribe:function(){var e=this;return u()(s.a.mark(function t(){var n;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.newStockCode){t.next=3;break}return e.$message.error("请输入股票代码"),t.abrupt("return");case 3:return e.loading=!0,t.prev=4,t.next=7,r={code:e.newStockCode},Object(h.a)({url:"/historyKl/unsubscribe",method:"get",params:r});case 7:if(200!==(n=t.sent).code){t.next=16;break}return e.$message.success("取消订阅成功"),t.next=12,e.fetchStocks();case 12:return t.next=14,e.createCharts();case 14:t.next=17;break;case 16:e.$message.error(n.message||"取消订阅失败");case 17:e.loading=!1,t.next=24;break;case 20:t.prev=20,t.t0=t.catch(4),console.error("Subscription error:",t.t0),e.loading=!1;case 24:case"end":return t.stop()}var r},t,e,[[4,20]])}))()},handleDateChange:function(){this.createCharts()},handleStockChange:function(){var e=this;this.$nextTick(function(){e.createCharts()})}},beforeDestroy:function(){this.charts.forEach(function(e){e&&e.dispose()}),this.charts=[],window.removeEventListener("resize",this.handleResize)}},x={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading.body.lock",value:e.loading,expression:"loading",modifiers:{body:!0,lock:!0}}],attrs:{"element-loading-text":"数据加载中..."}},[n("div",{staticClass:"date-picker-container"},[n("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},on:{change:e.handleDateChange},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}}),e._v(" "),n("el-select",{staticStyle:{"margin-left":"10px",width:"200px"},attrs:{placeholder:"请选择股票",clearable:"",filterable:""},on:{change:e.handleStockChange},model:{value:e.selectedStockCode,callback:function(t){e.selectedStockCode=t},expression:"selectedStockCode"}},e._l(e.stocks,function(t){return n("el-option",{key:t.code,attrs:{label:t.name,value:t.code}},[n("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),e._v(" "),n("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.code))])])}),1),e._v(" "),n("el-input",{staticStyle:{"margin-left":"10px",width:"150px"},attrs:{placeholder:"输入股票代码",disabled:e.loading},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSubscribe.apply(null,arguments)}},model:{value:e.newStockCode,callback:function(t){e.newStockCode=t},expression:"newStockCode"}}),e._v(" "),n("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",disabled:e.loading||!e.newStockCode},on:{click:e.handleSubscribe}},[e._v("\n      订阅\n    ")]),e._v(" "),n("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",disabled:e.loading||!e.newStockCode},on:{click:e.handleUnSubscribe}},[e._v("\n      取消订阅\n    ")])],1),e._v(" "),n("div",{staticClass:"chart-container",attrs:{id:"chart-container"}},e._l(e.filteredStocks,function(e){return n("div",{key:e.code,staticClass:"chart",attrs:{id:"chart-"+e.code}})}),0)])},staticRenderFns:[]};var g=n("VU/8")(m,x,!1,function(e){n("vZwD")},"data-v-9ae36056",null);t.default=g.exports},BO1k:function(e,t,n){e.exports={default:n("fxRn"),__esModule:!0}},Xd32:function(e,t,n){n("+tPU"),n("zQR9"),e.exports=n("5PlU")},d7EF:function(e,t,n){"use strict";t.__esModule=!0;var r=o(n("us/S")),a=o(n("BO1k"));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(){return function(e,t){if(Array.isArray(e))return e;if((0,r.default)(Object(e)))return function(e,t){var n=[],r=!0,o=!1,c=void 0;try{for(var i,s=(0,a.default)(e);!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,c=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw c}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},fxRn:function(e,t,n){n("+tPU"),n("zQR9"),e.exports=n("g8Ux")},g8Ux:function(e,t,n){var r=n("77Pl"),a=n("3fs2");e.exports=n("FeBl").getIterator=function(e){var t=a(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},"us/S":function(e,t,n){e.exports={default:n("Xd32"),__esModule:!0}},vZwD:function(e,t){}});
//# sourceMappingURL=4.3a0575286c7f117c578e.js.map