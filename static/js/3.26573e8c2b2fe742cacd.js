webpackJsonp([3],{"5PlU":function(e,t,n){var r=n("RY/4"),a=n("dSzd")("iterator"),c=n("/bQp");e.exports=n("FeBl").isIterable=function(e){var t=Object(e);return void 0!==t[a]||"@@iterator"in t||c.hasOwnProperty(r(t))}},BO1k:function(e,t,n){e.exports={default:n("fxRn"),__esModule:!0}},Jrhy:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("d7EF"),a=n.n(r),c=n("BO1k"),o=n.n(c),s=n("Xxa5"),i=n.n(s),u=n("exGp"),l=n.n(u),d=n("woOf"),f=n.n(d),p=n("XLwt"),h=n("yILr"),k={keyword:null,pageNum:1,pageSize:5,publishStatus:null,verifyStatus:null,productSn:null,productCategoryId:null,brandId:null},m={name:"StockCharts",data:function(){var e=new Date,t=new Date;return t.setTime(t.getTime()-31536e6),{listQuery:f()({},k),stocks:[],charts:[],dateRange:[t,e],selectedStockCode:"",newStockCode:"",loading:!1,pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-6048e5),e.$emit("pick",[n,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-2592e6),e.$emit("pick",[n,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-7776e6),e.$emit("pick",[n,t])}},{text:"最近六个月",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-15552e6),e.$emit("pick",[n,t])}},{text:"最近一年",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-31536e6),e.$emit("pick",[n,t])}},{text:"最近两年",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-63072e6),e.$emit("pick",[n,t])}},{text:"最近三年",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-94608e6),e.$emit("pick",[n,t])}},{text:"最近五年",onClick:function(e){var t=new Date,n=new Date;n.setTime(n.getTime()-15768e7),e.$emit("pick",[n,t])}},{text:"全部",onClick:function(e){var t=new Date,n=new Date;n.setTime(new Date("2015-01-01").getTime()),e.$emit("pick",[n,t])}}]}}},computed:{filteredStocks:function(){var e=this;return this.selectedStockCode?this.stocks.filter(function(t){return t.code===e.selectedStockCode}):this.stocks}},mounted:function(){var e=this;return l()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetchStocks();case 2:return t.next=4,e.createCharts();case 4:case"end":return t.stop()}},t,e)}))()},methods:{fetchStocks:function(){var e=this;return l()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(h.a)(e.listQuery).then(function(t){e.stocks=t.data});case 2:case"end":return t.stop()}},t,e)}))()},createCharts:function(){var e=this;return l()(i.a.mark(function t(){var n,r,a,c,s,u;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.charts.forEach(function(e){e&&e.dispose()}),e.charts=[],t.next=4,e.$nextTick();case 4:n=!0,r=!1,a=void 0,t.prev=7,c=o()(e.filteredStocks);case 9:if(n=(s=c.next()).done){t.next=16;break}return u=s.value,t.next=13,e.createChart(u);case 13:n=!0,t.next=9;break;case 16:t.next=22;break;case 18:t.prev=18,t.t0=t.catch(7),r=!0,a=t.t0;case 22:t.prev=22,t.prev=23,!n&&c.return&&c.return();case 25:if(t.prev=25,!r){t.next=28;break}throw a;case 28:return t.finish(25);case 29:return t.finish(22);case 30:e.handleResize=function(){e.charts.forEach(function(e){e&&e.resize()})},window.addEventListener("resize",e.handleResize),console.log("All charts loaded");case 33:case"end":return t.stop()}},t,e,[[7,18,22,30],[23,,25,29]])}))()},createChart:function(e){var t=this;return l()(i.a.mark(function n(){var r,c,o,s,u,l,d,f;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r="chart-"+e.code,c=document.getElementById(r)){n.next=5;break}return console.warn("Container "+r+" not found"),n.abrupt("return");case 5:return o=p.init(c),t.charts.push(o),s=t.dateRange||[null,null],u=a()(s,2),l=u[0],d=u[1],f={code:e.code,startDate:l?l.toISOString().split("T")[0]:null,endDate:d?d.toISOString().split("T")[0]:null},n.next=11,Object(h.b)(f).then(function(t){var n=t.data.historyKlList,r=n.map(function(e){return e.dataTime}),a=n.map(function(e){return[e.openPrice,e.closePrice,e.lowPrice,e.highPrice]}),c={title:{text:e.name+" ("+e.code+")",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",data:r,boundaryGap:!0,axisLine:{onZero:!1},splitLine:{show:!1},min:"dataMin",max:"dataMax"},yAxis:{scale:!0,splitArea:{show:!0}},dataZoom:[{type:"inside",start:0,end:100},{show:!0,type:"slider",top:"90%",start:0,end:100}],series:[{name:"Price",type:"candlestick",data:a,itemStyle:{color:"#00da3c",color0:"#ec0000",borderColor:"#008F28",borderColor0:"#8A0000"},large:!0}]};o.setOption(c)}).catch(function(t){console.error("Failed to fetch data for "+e.code+":",t)});case 11:case"end":return n.stop()}},n,t)}))()},handleSubscribe:function(){var e=this;return l()(i.a.mark(function t(){var n;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.newStockCode){t.next=3;break}return e.$message.error("请输入股票代码"),t.abrupt("return");case 3:return e.loading=!0,t.prev=4,t.next=7,Object(h.e)({code:e.newStockCode});case 7:if(200!==(n=t.sent).code){t.next=16;break}return e.$message.success("订阅成功"),t.next=12,e.fetchStocks();case 12:return t.next=14,e.createCharts();case 14:t.next=17;break;case 16:e.$message.error(n.message||"订阅失败");case 17:e.loading=!1,t.next=24;break;case 20:t.prev=20,t.t0=t.catch(4),console.error("Subscription error:",t.t0),e.loading=!1;case 24:case"end":return t.stop()}},t,e,[[4,20]])}))()},handleUnSubscribe:function(){var e=this;return l()(i.a.mark(function t(){var n;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.newStockCode){t.next=3;break}return e.$message.error("请输入股票代码"),t.abrupt("return");case 3:return e.loading=!0,t.prev=4,t.next=7,Object(h.f)({code:e.newStockCode});case 7:if(200!==(n=t.sent).code){t.next=16;break}return e.$message.success("取消订阅成功"),t.next=12,e.fetchStocks();case 12:return t.next=14,e.createCharts();case 14:t.next=17;break;case 16:e.$message.error(n.message||"取消订阅失败");case 17:e.loading=!1,t.next=24;break;case 20:t.prev=20,t.t0=t.catch(4),console.error("Subscription error:",t.t0),e.loading=!1;case 24:case"end":return t.stop()}},t,e,[[4,20]])}))()},manualSubscribe:function(){var e=this;return l()(i.a.mark(function t(){var n;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,Object(h.c)();case 4:if(200!==(n=t.sent).code){t.next=13;break}return e.$message.success("手动更新数据成功"),t.next=9,e.fetchStocks();case 9:return t.next=11,e.createCharts();case 11:t.next=14;break;case 13:e.$message.error(n.message||"手动更新数据失败");case 14:e.loading=!1,t.next=21;break;case 17:t.prev=17,t.t0=t.catch(1),console.error("manualSubscribeStock error:",t.t0),e.loading=!1;case 21:case"end":return t.stop()}},t,e,[[1,17]])}))()},handleDateChange:function(){this.createCharts()},handleStockChange:function(){var e=this;this.$nextTick(function(){e.createCharts()})}},beforeDestroy:function(){this.charts.forEach(function(e){e&&e.dispose()}),this.charts=[],window.removeEventListener("resize",this.handleResize)}},v={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading.body.lock",value:e.loading,expression:"loading",modifiers:{body:!0,lock:!0}}],attrs:{"element-loading-text":"数据加载中..."}},[n("div",{staticClass:"date-picker-container"},[n("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},on:{change:e.handleDateChange},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}}),e._v(" "),n("el-select",{staticStyle:{"margin-left":"10px",width:"200px"},attrs:{placeholder:"请选择股票",clearable:"",filterable:""},on:{change:e.handleStockChange},model:{value:e.selectedStockCode,callback:function(t){e.selectedStockCode=t},expression:"selectedStockCode"}},e._l(e.stocks,function(t){return n("el-option",{key:t.code,attrs:{label:t.name,value:t.code}},[n("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),e._v(" "),n("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.code))])])}),1),e._v(" "),n("el-input",{staticStyle:{"margin-left":"10px",width:"150px"},attrs:{placeholder:"输入股票代码",disabled:e.loading},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSubscribe.apply(null,arguments)}},model:{value:e.newStockCode,callback:function(t){e.newStockCode=t},expression:"newStockCode"}}),e._v(" "),n("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",disabled:e.loading||!e.newStockCode},on:{click:e.handleSubscribe}},[e._v("\n      订阅\n    ")]),e._v(" "),n("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",disabled:e.loading||!e.newStockCode},on:{click:e.handleUnSubscribe}},[e._v("\n      取消订阅\n    ")]),e._v(" "),n("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",disabled:e.loading},on:{click:e.manualSubscribe}},[e._v("\n      手动更新数据\n    ")])],1),e._v(" "),n("div",{staticClass:"chart-container",attrs:{id:"chart-container"}},e._l(e.filteredStocks,function(e){return n("div",{key:e.code,staticClass:"chart",attrs:{id:"chart-"+e.code}})}),0)])},staticRenderFns:[]};var x=n("VU/8")(m,v,!1,function(e){n("kw5d")},"data-v-58da79d3",null);t.default=x.exports},Xd32:function(e,t,n){n("+tPU"),n("zQR9"),e.exports=n("5PlU")},d7EF:function(e,t,n){"use strict";t.__esModule=!0;var r=c(n("us/S")),a=c(n("BO1k"));function c(e){return e&&e.__esModule?e:{default:e}}t.default=function(){return function(e,t){if(Array.isArray(e))return e;if((0,r.default)(Object(e)))return function(e,t){var n=[],r=!0,c=!1,o=void 0;try{for(var s,i=(0,a.default)(e);!(r=(s=i.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){c=!0,o=e}finally{try{!r&&i.return&&i.return()}finally{if(c)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},fxRn:function(e,t,n){n("+tPU"),n("zQR9"),e.exports=n("g8Ux")},g8Ux:function(e,t,n){var r=n("77Pl"),a=n("3fs2");e.exports=n("FeBl").getIterator=function(e){var t=a(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},kw5d:function(e,t){},"us/S":function(e,t,n){e.exports={default:n("Xd32"),__esModule:!0}},yILr:function(e,t,n){"use strict";t.a=function(e){return Object(r.a)({url:"/us/stocksBase/listAll",method:"get",params:e})},t.b=function(e){return Object(r.a)({url:"/us/historyKl/list",method:"get",params:e})},t.e=function(e){return Object(r.a)({url:"/us/historyKl/subscribe",method:"get",params:e})},t.f=function(e){return Object(r.a)({url:"/us/historyKl/unsubscribe",method:"get",params:e})},t.c=function(e){return Object(r.a)({url:"/us/historyKl/manual-update",method:"get",params:e})},t.d=function(e){return Object(r.a)({url:"/us/stocksBase/ping-status",method:"get",params:e})};var r=n("vLgD")}});
//# sourceMappingURL=3.26573e8c2b2fe742cacd.js.map